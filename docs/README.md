# ymsummorizer

Телеграм бот для создания совместных плейлистов в Яндекс.Музыке.


В проекте есть несколько сущеностей:
1. **Пользователь**. Имеет несколько ролей, характеризуется следующими полями:
  * "id": Локальный GUID для идентификации внутри проекта.
  * "name": Имя пользователя для уникального опыта взаимодействия.
  * "tg_login": Логин пользователя в Телеграм, нужен для взаимодействия с ним.
  * "yandex_login": Логин в сервисах Яндекс, нужен для просмотра его плейлистов.
  * "yandex_token": Токен для изменения данных пользователя, нужен для редактирования его плейлистов.

2. **Плейлисты**. Объединение людей, имющих один или несколько совместных плейлистов.
Характеризуется следующими полями:
* "id": Локальный GUID для идентификации внутри проекта.
* "name": Локальный GUID для идентификации внутри проекта.
* "group_id": Локальный GUID для идентификации внутри проекта.
* "yandex_tracks": Массив одобренных треков в Яндекс.Музыке данной группы.
* "yandex_users": Массив реальных плейлистов пользователей. Характеризуется через:
  * "user_id": GUID пользователя системы проекта.
  * "kind": Идентификатор плейлиста в системе Яндекса.

3. **Группы** пользователей. Объединение людей, имющих один или несколько совместных плейлистов.
Характеризуется группа двумя списками: пользователей, которые к ней относятся, и плейлистами.

4. **Администраторы**. Роль пользователей, которые могу создавать, удалять и редактировать группы.
Характеризуется списком пользователей, которые относятся к этой роли.

5. **СуперАдминистраторы**. Роль пользователей, которые могу создавать, удалять и редактировать группы.
Характеризуется списком пользователей, которые относятся к этой роли.

Схема работы простая, она ориентирована на группу пользователей как основную сущеность.
Плейлист, созданный в рамках группы, появляется у каждого пользователя, входящего в группу.
После добавлении трека в плейдлист пользователя, бот запрашивает подтверждение у каждого пользователя, чтобы его оставить.
Если все согласны, то трек появляется в плейлистах каждого отдельного пользователя.
Если есть несогласные, то трек удаляется из плейлиста каждого отдельного пользователя.
Аналогичный процесс с удалением трека их плейлиста любого пользователя:

## service

Бизнес логика проекта.

Запускает имплементации взаимодействия с пользователями (телеграм-бот), а также задачи обслуживания.
Самая главная задача: периодически прогонять все плейлисты из БД и сравнивать их с основным плейлистом группы.

## tgbot

Телеграм бот проекта.

Только один из вариантов взаимодействия с пользователем, основной на данный момент.

Запускается через `bot_impl::start()`, в конце вызывается `bot_impl::stop()`.

Имплементирует `bot_impl::set_callback_command(command_type ct, callback_cmd &&callback)`, 
через который можно задать callback на действие пользователя. Другие имплементации взаимодействий 
так же могут использовать подобный интерфейс, чтобы вся бизнес-логика могла находится


## storage

Интерфейс для работы с БД.

Имеет несколько имплементаций:
* CFG: хранение данных в локальном [зашифрованном] JSON файле.
* SQLite: хранение данных в локальной БД. Не поддерживается.
* MsSQL: хранение данных в удалённой БД. Не поддерживается.
* MySQL: хранение данных в удалённой БД. Не поддерживается.

## ymapi

Интерфейс взаимодействия с Яндекс.Музыкой.

## common

Вспомогательные сущности проекта, типы данных.

